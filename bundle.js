(()=>{"use strict";class e{constructor(e){this.title=e.title,this.rating=e.rating,this.image=e.image,this.description=e.description,this.minParticipants=e.minParticipants,this.maxParticipants=e.maxParticipants}render(){let e=document.createElement("li");e.classList.add("challenges-item");let t=document.createElement("img");t.classList.add("challenge-picture"),t.src=this.image;let n=document.createElement("h3");n.classList.add("challenge-title"),n.innerHTML=this.title;let a=document.createElement("div");a.classList.add("challenge-meta");let i=document.createElement("ul");i.classList.add("challenge-rating");for(let e=0;e<Math.floor(this.rating);e++){let e=document.createElement("li");e.classList.add("challenge-rating-star"),e.classList.add("on"),i.appendChild(e)}for(let e=Math.floor(this.rating);e<5;e++){let e=document.createElement("li");e.classList.add("challenge-rating-star"),e.classList.add("off"),i.appendChild(e)}let s=document.createElement("small");s.classList.add("challenge-size"),s.innerHTML=`${this.minParticipants}-${this.maxParticipants} participants`;let l=document.createElement("p");l.classList.add("challenge-description"),l.innerHTML=this.description;let r=document.createElement("a");return r.classList.add("challenge-cta"),r.innerHTML="Book the room",r.addEventListener("click",(()=>{!function(e,t,n){const a=document.createElement("dialog");a.className="modal",a.id="myModal",document.body.appendChild(a),a.style.display="block";const i=document.createElement("div");i.className="modal-content",a.append(i);const s=document.createElement("h1");s.class="modal1h1",s.id="modal1h1",i.append(s);const l=document.createElement("p");l.textContent="What date would you like to come?",i.append(l);const r=document.createElement("input"),c=document.createElement("label");document.createElement("br"),r.name="inpDate",r.id="date",r.type="date",r.name="date",c.textContent="Date",i.append(c),i.append(r);const d=new Date;d.setYear(d.getFullYear()+1),date.max=d.toISOString().split("T")[0];const o=new Date;date.min=o.toISOString().split("T")[0];const m=document.createElement("button");m.innerText="Search available times",m.className="btnSearch",i.append(m);const h=document.createElement("div");h.className="modal-content",h.id="divstep2",a.append(h);const p=document.createElement("h1");p.class="modal2h1",p.id="modal2h1",h.append(p);const u=document.createElement("input"),y=document.createElement("label");u.name="inpName",u.type="text",y.textContent="Name",h.append(y),h.append(u);const f=document.createElement("input"),g=document.createElement("label");f.name="inpEmail",f.type="email",g.textContent="E-mail",h.append(g),h.append(f);const b=document.createElement("select");b.name="timeList",b.id="availableTimeList";const E=document.createElement("label");E.textContent="What time?",h.append(E),h.append(b);const L=document.createElement("select");L.name="participantsList",L.id="availableParticipantsList";const C=document.createElement("label");C.textContent="How many participants?",h.append(C),h.append(L);const v=document.createElement("button");v.innerText="Submit booking",v.className="btnSubmit",h.append(v);const x=document.createElement("div");x.className="modal-content",x.id="divstep3",a.append(x);const k=document.createElement("h1");k.class="modal3h1",k.textContent="Thank you!",x.append(k);const S=document.createElement("a");function T(){return""==r.value&&alert("Error, no selected date."),r.value}x.append(S),S.setAttribute("href",""),S.textContent="Back to challenges",S.onclick=function(){body.removeChild(a)},document.getElementById("modal1h1").textContent='Book room "'+e+'" (step 1)',window.onclick=function(e){e.target==a&&document.body.removeChild(a)},r.onblur=function(){this.type="text"},m.onclick=function(){!async function(a){await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/available-times?date="+a,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then((function(a){a.ok&&a.json().then((function(a){!function(a){let s,l;document.getElementById("modal2h1").textContent='Book room "'+e+'" (step 2)';for(let e=0;e<a.length;e++)s=document.createElement("option"),s.text=a[e],s.value=a[e],b.add(s);for(let e=t;e<=n;e++)l=document.createElement("option"),l.text=e+" participants",l.value=e,L.add(l);i.style.display="none",h.style.display="block"}(a.slots)}))}))}(T())},v.onclick=function(){const e=T();!async function(e,t,n,a,i){const s=await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/reservations",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,date:n,time:a,participants:parseInt(i)})}),l=await s.json();console.log(l)}((""==u.value&&alert("Error, no entered participant name."),u.value),function(){if(""==f.value)alert("Error, no entered e-mail.");else{if(f.value.match(/^[^]+@[^]+\.[a-z]{2,3}$/))return f.value;alert("Error, the entered email is invalid.")}}(),e,(""==b.value&&alert("Error, no selected time."),b.value),(""==L.value&&alert("Error, no selected participants number."),L.value)),h.style.display="none",x.style.display="block"}}(this.title,this.minParticipants,this.maxParticipants)})),e.appendChild(t),e.appendChild(n),e.appendChild(a),a.appendChild(i),a.appendChild(s),e.appendChild(l),e.appendChild(r),e}}class t{constructor(e){this.filters=e}filterArray(e){let t=[],n=[];return this.filters.byOnline&&(n=e.filter((e=>"online"===e.type)),t=[...t,...n]),this.filters.byOnsite&&(n=e.filter((e=>"onsite"===e.type)),t=[...t,...n]),this.filters.byLabel&&(t=t.filter((e=>this.filters.labelsFilters.every((t=>e.labels.includes(t)))))),this.filters.byRating&&(t=t.filter((e=>{if(e.rating>=this.filters.minRatingFilter&&e.rating<=this.filters.maxRatingFilter)return e}))),this.filters.byText&&(t=t.filter((e=>e.description.toUpperCase().includes(this.filters.textFilter.toUpperCase())||e.title.toUpperCase().includes(this.filters.textFilter.toUpperCase())))),t}}const n=document.querySelector(".challenges-list"),a=new class{constructor(){this.challenges=null}async load(){if(!this.challenges)try{const e=await fetch("https://lernia-sjj-assignments.vercel.app/api/challenges"),t=await e.json();this.challenges=t.challenges}catch(e){console.log(e)}return this.challenges}},i=new class{constructor(e,t){this.retriever=e,this.container=t,this.challengeItems=[],this.filters={byOnline:!0,byOnsite:!0,byLabel:!1,byRating:!1,byText:!1,labelsFilters:[],minRatingFilter:0,maxRatingFilter:5,textFilter:""},this.labelsArray=[],this.minStarsArray=[],this.maxStarsArray=[]}async run(){this.challenges=await this.retriever.load(),this.render()}render(){new t(this.filters).filterArray(this.challenges).forEach((t=>{const n=new e(t).render();this.container.appendChild(n),this.challengeItems.push(t)}));const n=document.querySelector(".filter-cta");n.addEventListener("click",(()=>{n.style.display="none",a.style.display="block"}));const a=document.querySelector(".filter-board");a.style.display="none";const i=document.createElement("div");i.classList.add("filter-menu"),a.appendChild(i);const s=document.createElement("h3");s.classList.add("filter-box-title"),i.appendChild(s),s.innerHTML="Filter challenges";const l=document.createElement("a");l.classList.add("x-button-style");const r=document.createElement("p");r.innerHTML="&#10005;",l.appendChild(r),i.appendChild(l),l.addEventListener("click",(()=>{n.style.display="block",a.style.display="none"}));const c=document.createElement("div");c.classList.add("choose-filter-box"),i.appendChild(c);const d=document.createElement("div");d.classList.add("filter-by-type"),c.appendChild(d);const o=document.createElement("h4");o.innerHTML="By Type",d.appendChild(o);const m=document.createElement("ul");d.appendChild(m);const h=document.createElement("li");m.appendChild(h),h.addEventListener("change",(()=>{this.filters.byOnline?(this.filters.byOnline=!1,this.rerender()):(this.filters.byOnline=!0,this.rerender())}));const p=document.createElement("input");p.type="checkbox",p.checked=!0,h.appendChild(p);const u=document.createElement("label");u.innerHTML="&nbspInclude online challenges",h.appendChild(u);const y=document.createElement("li");m.appendChild(y),y.addEventListener("change",(()=>{this.filters.byOnsite?(this.filters.byOnsite=!1,this.rerender()):(this.filters.byOnsite=!0,this.rerender())}));const f=document.createElement("input");f.type="checkbox",f.checked=!0,y.appendChild(f);const g=document.createElement("label");g.innerHTML="&nbspInclude on-site challenges",y.appendChild(g);const b=document.createElement("div");b.classList.add("filter-by-rating"),c.appendChild(b);const E=document.createElement("h4");E.innerHTML="By Rating",b.appendChild(E);const L=document.createElement("ul");function C(e){for(let t=0;t<5;t++)e[t]=document.createElement("li"),e[t].classList.add("filter-rating-star"),e[t].classList.add("off"),L.appendChild(e[t]),e.push()}b.appendChild(L),C(this.minStarsArray),this.minStarsArray.forEach((e=>{e.addEventListener("click",(()=>{let t=this.minStarsArray.indexOf(e),n=t+1;if(e.classList.contains("off"))for(;t>=0;t--)this.minStarsArray[t].classList.add("on"),this.minStarsArray[t].classList.remove("off");else for(n--;t<this.minStarsArray.length;++t)this.minStarsArray[t].classList.add("off"),this.minStarsArray[t].classList.remove("on");this.filters.minRatingFilter=n,this.filters.byRating=!0,this.rerender()}))}));const v=document.createElement("li");v.innerHTML="&nbspto&nbsp",v.style.textAlign="center",v.style.padding="0.5rem",L.appendChild(v),C(this.maxStarsArray),this.maxStarsArray.forEach((e=>{e.addEventListener("click",(()=>{let t=this.maxStarsArray.indexOf(e),n=t+1;if(e.classList.contains("off"))for(;t>=0;t--)this.maxStarsArray[t].classList.add("on"),this.maxStarsArray[t].classList.remove("off");else for(n--;t<this.maxStarsArray.length;++t)this.maxStarsArray[t].classList.add("off"),this.maxStarsArray[t].classList.remove("on");this.filters.maxRatingFilter=n,this.filters.byRating=!0,this.rerender()}))}));const x=document.createElement("div");x.classList.add("filter-by-tag"),c.appendChild(x);const k=document.createElement("h4");k.innerHTML="By Tag",x.appendChild(k);const S=document.createElement("div");S.classList.add("filter-by-tag-item"),x.appendChild(S),this.challenges.forEach((e=>{e.labels.forEach((e=>{if(!this.labelsArray.includes(e)){this.labelsArray.push(e);const t=document.createElement("label");t.innerHTML=e,t.style.backgroundColor="white",S.appendChild(t),t.addEventListener("click",(e=>{"white"==t.style.backgroundColor?(t.style.backgroundColor="lightslategray",t.style.color="white",t.style.borderColor="lightslategray"):(t.style.backgroundColor="white",t.style.color="gray",t.style.borderColor="lightgray");const n=e.target.innerText,a=this.filters.labelsFilters.indexOf(n);this.filters.labelsFilters.includes(n)?this.filters.labelsFilters.splice(a,1):this.filters.labelsFilters.push(n),this.filters.labelsFilters.length>0?this.filters.byLabel=!0:this.filters.byLabel=!1,this.rerender()}))}}))}));const T=document.createElement("div");T.classList.add("filter-search-text"),i.appendChild(T);const A=document.createElement("h4");A.innerHTML="Or type to search for keyword",T.appendChild(A);const w=document.createElement("input");w.type="text",w.classList.add("filter-search-input"),w.placeholder="Start typing to filter",w.addEventListener("keyup",(()=>{this.filters.byText=!0,this.filters.textFilter=w.value,this.rerender()})),T.appendChild(w)}rerender(){this.container.innerHTML="";const n=new t(this.filters).filterArray(this.challengeItems);if(0===n.length||null===n){const e=document.createElement("div");e.innerHTML="No matching challenges",e.classList.add("no-challenges"),this.container.appendChild(e)}n.forEach((t=>{const n=new e(t).render();this.container.appendChild(n)}))}}(a,n);i.run()})();