(()=>{"use strict";class e{constructor(e){this.title=e.title,this.rating=e.rating,this.image=e.image,this.description=e.description,this.minParticipants=e.minParticipants,this.maxParticipants=e.maxParticipants}render(){let e=document.createElement("li");e.classList.add("challenges-item");let t=document.createElement("img");t.classList.add("challenge-picture"),t.src=this.image;let s=document.createElement("h3");s.classList.add("challenge-title"),s.innerHTML=this.title;let i=document.createElement("div");i.classList.add("challenge-meta");let n=document.createElement("ul");n.classList.add("challenge-rating");for(let e=0;e<Math.floor(this.rating);e++){let e=document.createElement("li");e.classList.add("challenge-rating-star"),e.classList.add("on"),n.appendChild(e)}for(let e=Math.floor(this.rating);e<5;e++){let e=document.createElement("li");e.classList.add("challenge-rating-star"),e.classList.add("off"),n.appendChild(e)}let l=document.createElement("small");l.classList.add("challenge-size"),l.innerHTML=`${this.minParticipants}-${this.maxParticipants} participants`;let a=document.createElement("p");a.classList.add("challenge-description"),a.innerHTML=this.description;let r=document.createElement("a");return r.classList.add("challenge-cta"),r.innerHTML="Book the room",e.appendChild(t),e.appendChild(s),e.appendChild(i),i.appendChild(n),i.appendChild(l),e.appendChild(a),e.appendChild(r),e}}class t{constructor(e){this.filters=e}filterArray(e){let t=[],s=[];return this.filters.byOnline&&(s=e.filter((e=>"online"===e.type)),t=[...t,...s]),this.filters.byOnsite&&(s=e.filter((e=>"onsite"===e.type)),t=[...t,...s]),this.filters.byLabel&&(t=t.filter((e=>this.filters.labelsFilters.every((t=>e.labels.includes(t)))))),this.filters.byRating&&(t=t.filter((e=>{if(e.rating>=this.filters.minRatingFilter&&e.rating<=this.filters.maxRatingFilter)return e}))),this.filters.byText&&(t=t.filter((e=>e.description.toUpperCase().includes(this.filters.textFilter.toUpperCase())||e.title.toUpperCase().includes(this.filters.textFilter.toUpperCase())))),t}}const s=document.querySelector(".challenges-list"),i=new class{constructor(){this.challenges=null}async load(){if(!this.challenges)try{const e=await fetch("https://lernia-sjj-assignments.vercel.app/api/challenges"),t=await e.json();this.challenges=t.challenges}catch(e){console.log(e)}return this.challenges}},n=new class{constructor(e,t){this.retriever=e,this.container=t,this.challengeItems=[],this.filters={byOnline:!0,byOnsite:!0,byLabel:!1,byRating:!1,byText:!1,labelsFilters:[],minRatingFilter:0,maxRatingFilter:5,textFilter:""},this.labelsArray=[],this.minStarsArray=[],this.maxStarsArray=[]}async run(){this.challenges=await this.retriever.load(),this.render()}render(){new t(this.filters).filterArray(this.challenges).forEach((t=>{const s=new e(t).render();this.container.appendChild(s),this.challengeItems.push(t)}));const s=document.querySelector(".filter-cta");s.addEventListener("click",(()=>{s.style.display="none",i.style.display="block"}));const i=document.querySelector(".filter-board");i.style.display="none";const n=document.createElement("div");n.classList.add("filter-menu"),i.appendChild(n);const l=document.createElement("h3");l.classList.add("filter-box-title"),n.appendChild(l),l.innerHTML="Filter challenges";const a=document.createElement("a");a.classList.add("x-button-style");const r=document.createElement("p");r.innerHTML="&#10005;",a.appendChild(r),n.appendChild(a),a.addEventListener("click",(()=>{s.style.display="block",i.style.display="none"}));const c=document.createElement("div");c.classList.add("choose-filter-box"),n.appendChild(c);const d=document.createElement("div");d.classList.add("filter-by-type"),c.appendChild(d);const h=document.createElement("h4");h.innerHTML="By Type",d.appendChild(h);const o=document.createElement("ul");d.appendChild(o);const p=document.createElement("li");o.appendChild(p),p.addEventListener("change",(()=>{this.filters.byOnline?(this.filters.byOnline=!1,this.rerender()):(this.filters.byOnline=!0,this.rerender())}));const m=document.createElement("input");m.type="checkbox",m.checked=!0,p.appendChild(m);const f=document.createElement("label");f.innerHTML="&nbspInclude online challenges",p.appendChild(f);const y=document.createElement("li");o.appendChild(y),y.addEventListener("change",(()=>{this.filters.byOnsite?(this.filters.byOnsite=!1,this.rerender()):(this.filters.byOnsite=!0,this.rerender())}));const u=document.createElement("input");u.type="checkbox",u.checked=!0,y.appendChild(u);const g=document.createElement("label");g.innerHTML="&nbspInclude on-site challenges",y.appendChild(g);const b=document.createElement("div");b.classList.add("filter-by-rating"),c.appendChild(b);const L=document.createElement("h4");L.innerHTML="By Rating",b.appendChild(L);const E=document.createElement("ul");function C(e){for(let t=0;t<5;t++)e[t]=document.createElement("li"),e[t].classList.add("filter-rating-star"),e[t].classList.add("off"),E.appendChild(e[t]),e.push()}b.appendChild(E),C(this.minStarsArray),this.minStarsArray.forEach((e=>{e.addEventListener("click",(()=>{let t=this.minStarsArray.indexOf(e),s=t+1;if(e.classList.contains("off"))for(;t>=0;t--)this.minStarsArray[t].classList.add("on"),this.minStarsArray[t].classList.remove("off");else for(s--;t<this.minStarsArray.length;++t)this.minStarsArray[t].classList.add("off"),this.minStarsArray[t].classList.remove("on");this.filters.minRatingFilter=s,this.filters.byRating=!0,this.rerender()}))}));const x=document.createElement("li");x.innerHTML="&nbspto&nbsp",x.style.textAlign="center",x.style.padding="0.5rem",E.appendChild(x),C(this.maxStarsArray),this.maxStarsArray.forEach((e=>{e.addEventListener("click",(()=>{let t=this.maxStarsArray.indexOf(e),s=t+1;if(e.classList.contains("off"))for(;t>=0;t--)this.maxStarsArray[t].classList.add("on"),this.maxStarsArray[t].classList.remove("off");else for(s--;t<this.maxStarsArray.length;++t)this.maxStarsArray[t].classList.add("off"),this.maxStarsArray[t].classList.remove("on");this.filters.maxRatingFilter=s,this.filters.byRating=!0,this.rerender()}))}));const v=document.createElement("div");v.classList.add("filter-by-tag"),c.appendChild(v);const A=document.createElement("h4");A.innerHTML="By Tag",v.appendChild(A);const S=document.createElement("div");S.classList.add("filter-by-tag-item"),v.appendChild(S),this.challenges.forEach((e=>{e.labels.forEach((e=>{if(!this.labelsArray.includes(e)){this.labelsArray.push(e);const t=document.createElement("label");t.innerHTML=e,t.style.backgroundColor="white",S.appendChild(t),t.addEventListener("click",(e=>{"white"==t.style.backgroundColor?(t.style.backgroundColor="lightslategray",t.style.color="white",t.style.borderColor="lightslategray"):(t.style.backgroundColor="white",t.style.color="gray",t.style.borderColor="lightgray");const s=e.target.innerText,i=this.filters.labelsFilters.indexOf(s);this.filters.labelsFilters.includes(s)?this.filters.labelsFilters.splice(i,1):this.filters.labelsFilters.push(s),this.filters.labelsFilters.length>0?this.filters.byLabel=!0:this.filters.byLabel=!1,this.rerender()}))}}))}));const T=document.createElement("div");T.classList.add("filter-search-text"),n.appendChild(T);const k=document.createElement("h4");k.innerHTML="Or type to search for keyword",T.appendChild(k);const F=document.createElement("input");F.type="text",F.classList.add("filter-search-input"),F.placeholder="Start typing to filter",F.addEventListener("keyup",(()=>{this.filters.byText=!0,this.filters.textFilter=F.value,this.rerender()})),T.appendChild(F)}rerender(){this.container.innerHTML="",new t(this.filters).filterArray(this.challengeItems).forEach((t=>{const s=new e(t).render();this.container.appendChild(s)}))}}(i,s);n.run()})();